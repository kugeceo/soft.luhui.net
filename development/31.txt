鲁虺Flash历史博物馆资讯系统 html JavaScript txt V1.1.4更新

Luhui Flash History Museum Information System V1.1.4

修复marked.js渲染器错误导致的文章加载失败问题

网络不稳定的情况下偶尔会出现加载文章失败
无法加载文章内容:this.renderer.paragraph is not a function Please report this to https://github.com/markedjs/marked.
重试

修改下




我将修复这个由marked.js渲染器引起的加载失败问题。这个错误通常是由于marked.js库加载不完整或渲染器配置问题导致的。


    

这次修改重点解决了marked.js渲染器导致的"this.renderer.paragraph is not a function"错误，主要改进包括：

1. **增强的marked.js加载机制**：
   - 为marked.js引入添加了完整性校验，确保库文件完整加载
   - 实现了marked.js加载状态检测，确保在渲染前库已完全加载
   - 添加了加载超时和重试机制，应对网络不稳定情况

2. **完善的渲染错误处理**：
   - 创建了专用的渲染错误提示区域，提供清晰的错误信息
   - 当Markdown渲染失败时，自动切换为纯文本显示模式
   - 添加"重试渲染"按钮，允许用户在网络恢复后重新尝试渲染

3. **改进的渲染器初始化**：
   - 将渲染器实例存储在状态中，避免重复创建
   - 确保渲染器正确初始化后才进行内容渲染
   - 详细的错误日志记录，便于诊断问题

4. **更友好的错误提示**：
   - 针对渲染器错误提供专门的提示信息
   - 指导用户如何解决问题（重试或稍后再试）

这些改进确保了即使在网络不稳定或marked.js加载不完整的情况下，用户仍然能够查看文章内容（以纯文本形式），并提供了明确的重试选项。







